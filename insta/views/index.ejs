<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Insta - Feed</title>
    <link rel="stylesheet" href="/static/style.css">
  </head>
  <body>
    <header>
      <h1><a href="/">Insta</a></h1>
      <% if (user) { %>
        <span>Signed in as <a href="/profile/<%=user.username%>"><%=user.username%></a></span>
        <a href="/upload">Upload</a> | <a href="/logout">Logout</a>
      <% } else { %>
        <a href="/login">Login</a> | <a href="/signup">Signup</a>
      <% } %>
    </header>

    <main>
      <% posts.forEach(p=>{ %>
        <article>
          <h3><a href="/profile/<%=p.username%>"><%=p.username%></a></h3>
          <img src="/uploads/<%=p.image%>" style="max-width:600px;">
          <p><%=p.caption%></p>
          <form action="/like/<%=p.id%>" method="POST" class="like-form">
            <button type="submit">Like</button>
          </form>
        </article>
      <% }) %>
    </main>
  </body>
  <script>
    document.querySelectorAll('.like-form').forEach(f=>{
      f.addEventListener('submit', async e=>{
        e.preventDefault();
        const resp = await fetch(f.action, { method: 'POST' });
        const data = await resp.json();
        alert(data.liked ? 'Liked' : 'Unliked');
      });
    });
  </script>
</html>
